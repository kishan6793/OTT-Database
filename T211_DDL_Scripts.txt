CREATE SCHEMA OTT;

set search_path to ott;

CREATE TABLE Production(
	Production_ID INT PRIMARY KEY,
	Name  VARCHAR(50) NOT NULL,
	PAN_No VARCHAR(10) NOT NULL UNIQUE,
	Location VARCHAR(30) NOT NULL
);

CREATE TABLE Content(
	Content_ID INT PRIMARY KEY,
	Title VARCHAR(50) NOT NULL,
	Content_Type VARCHAR(10) NOT NULL,
	Release_Date DATE NOT NULL,
	Age_rating VARCHAR(3) NOT NULL,
	IMDB_rating REAL,
	Production_ID INT REFERENCES Production(Production_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE Coming_soon(
	Content_ID INT PRIMARY KEY,
	FOREIGN KEY(Content_ID) REFERENCES Content(Content_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE Content_Audio(
	Content_ID INT,
	Audio VARCHAR(20),
	PRIMARY KEY(Content_ID, Audio),
	FOREIGN KEY(Content_ID) REFERENCES Content(Content_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE Content_Genre(
	Content_ID INT,
	Genre VARCHAR(20),
	PRIMARY KEY(Content_ID, Genre),
	FOREIGN KEY(Content_ID) REFERENCES Content(Content_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE Content_Subtitle(
	Content_ID INT,
	Subtitle VARCHAR(20),
	PRIMARY KEY(Content_ID, Subtitle),
	FOREIGN KEY(Content_ID) REFERENCES Content(Content_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE Ott_User(
	User_ID INT PRIMARY KEY,
	Name VARCHAR(50) NOT NULL,
	Gender VARCHAR(6) NOT NULL,
	DOB DATE NOT NULL,
	Email VARCHAR(30),
	Contact_No CHAR(10) NOT NULL UNIQUE,
	Street VARCHAR(50) NOT NULL,
	City VARCHAR(30) NOT NULL,
	Start_date DATE,
	Subscription_type VARCHAR(10),
	Duration SMALLINT
);

CREATE TABLE Watchlist(
	User_ID INT,
	Watchlist VARCHAR(50),
	PRIMARY KEY(User_ID, Watchlist),
	FOREIGN KEY(User_ID) REFERENCES Ott_User(User_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE Streams(
	Stream_ID INT PRIMARY KEY,
	Stream_date DATE NOT NULL,
	Stream_Start_time TIME NOT NULL,
	Duration TIME NOT NULL,	
	Content_ID INT REFERENCES Content(Content_ID) ON DELETE CASCADE ON UPDATE CASCADE,
	User_ID INT REFERENCES Ott_User(User_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE TV_Series(
	Content_ID INT PRIMARY KEY,
	First_Air_Date DATE NOT NULL,
	Total_Seasons SMALLINT NOT NULL,
	End_Date DATE NOT NULL,
	FOREIGN KEY(Content_ID) REFERENCES Content(Content_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE Episode(
	Episode_No SMALLINT NOT NULL,
	Season_No SMALLINT NOT NULL,
	Release_Date DATE NOT NULL,
	Title VARCHAR(200) NOT NULL,
	Description VARCHAR(1000) NOT NULL,
	Rating REAL NOT NULL,
	Duration TIME NOT NULL,
	Content_ID INT REFERENCES TV_Series(Content_ID) ON DELETE CASCADE ON UPDATE CASCADE,
	PRIMARY KEY(Episode_No, Season_No, Content_ID)
);

CREATE TABLE Shows(
	Content_ID INT PRIMARY KEY,
	Duration TIME NOT NULL,
	FOREIGN KEY(Content_ID) REFERENCES Content(Content_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE Movies(
	Content_ID INT PRIMARY KEY,
	Duration TIME NOT NULL,
	FOREIGN KEY(Content_ID) REFERENCES Content(Content_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE Actor(
	Actor_ID INT PRIMARY KEY,
	Name VARCHAR(50) NOT NULL,
	Gender VARCHAR(6) NOT NULL,
	DOB DATE NOT NULL, 
	Nationality VARCHAR(20) NOT NULL
);

CREATE TABLE Content_Cast(
	Role VARCHAR(70),
	Actor_ID INT REFERENCES Actor(Actor_ID) ON DELETE CASCADE ON UPDATE CASCADE,
	Content_ID INT REFERENCES Content(Content_ID) ON DELETE CASCADE ON UPDATE CASCADE,
	PRIMARY KEY(Role, Actor_ID, Content_ID)
);

CREATE TABLE Starred_in(
	Actor_ID INT,
	Content_ID INT,
	PRIMARY KEY(Actor_ID, Content_ID),
	FOREIGN KEY(Content_ID) REFERENCES Content(Content_ID) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY(Actor_ID) REFERENCES Actor(Actor_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE Related_Shows(
	Show_ID INT,
	Content_ID INT,
	PRIMARY KEY(Show_ID, Content_ID),
	Similarity SMALLINT NOT NULL,
	FOREIGN KEY(Content_ID) REFERENCES Content(Content_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE Advertisement(
	Advertise_ID INT PRIMARY KEY,
	Product_Name VARCHAR(50) NOT NULL,
	Company_Name VARCHAR(50) NOT NULL,
	AD_Cost REAL NOT NULL,
	Views INT NOT NULL,
	Revenue REAL NOT NULL
);

CREATE TABLE Advertise_Genre(
	Advertise_ID INT,
	Genre VARCHAR(20),
	PRIMARY KEY(Advertise_ID, Genre),
	FOREIGN KEY(Advertise_ID) REFERENCES Advertisement(Advertise_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE Displayed_IN(
	Advertise_ID INT,
	Content_ID INT,
	PRIMARY KEY(Advertise_ID, Content_ID),
	FOREIGN KEY(Advertise_ID) REFERENCES Advertisement(Advertise_ID) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY(Content_ID) REFERENCES Content(Content_ID) ON DELETE CASCADE ON UPDATE CASCADE
); 

CREATE TABLE Statistics(
	Content_ID INT PRIMARY KEY,
	Total_View INT NOT NULL,
	Revenue REAL NOT NULL,
	Budget REAL NOT NULL,
	FOREIGN KEY(Content_ID) REFERENCES Content(Content_ID) ON DELETE CASCADE ON UPDATE CASCADE
);